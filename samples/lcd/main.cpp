#include <EVT/dev/LCD.hpp>
#include <EVT/io/UART.hpp>
#include <EVT/io/manager.hpp>
#include <EVT/utils/time.hpp>

namespace DEV = EVT::core::DEV;
namespace IO = EVT::core::IO;
namespace time = EVT::core::time;

constexpr uint32_t SPI_SPEED = SPI_SPEED_500KHZ;// 62.5KHz

constexpr uint8_t deviceCount = 1;

IO::GPIO* devices[deviceCount];


unsigned char bitMap[8192] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x1f,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x1f,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x00,0x3f,0xff,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x00,0x7f,0xff,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x00,0x7f,0xff,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x00,0xff,0xff,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x00,0xff,0xff,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x00,0xff,0xff,0xc0,0x00,0x01,0xff,0xff,0xfe,0x00,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x00,0xff,0xff,0xc0,0x00,0x07,0xff,0xff,0xfe,0x00,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x00,0xff,0xff,0xc0,0x00,0x07,0xff,0xff,0xfe,0x00,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x00,0xff,0xff,0xc0,0x00,0x07,0xff,0xff,0xfe,0x00,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x01,0xff,0xff,0xc0,0x00,0x07,0xff,0xff,0xff,0xc0,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x01,0xff,0xff,0xc0,0x00,0x07,0xff,0xff,0xff,0xc0,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x03,0xff,0x7f,0xc0,0x06,0x07,0xff,0xff,0xff,0xc0,0x00
,0x00,0x00,0x0f,0xf0,0x00,0x03,0xff,0x7f,0xc0,0x00,0x07,0xff,0xff,0xff,0xc0,0x00
,0x00,0x00,0x1f,0xf0,0x00,0x03,0xff,0x3f,0xc0,0x00,0x07,0xfe,0x00,0x3f,0xc0,0x00
,0x00,0x00,0x1f,0xf0,0x00,0x03,0xff,0x3f,0xe0,0x00,0x00,0x00,0x00,0x7f,0xc0,0x00
,0x00,0x00,0x1f,0xf0,0x00,0x0f,0xff,0x3f,0xe0,0x00,0x00,0x00,0x00,0x7f,0xc0,0x00
,0x00,0x00,0x1f,0xf0,0x00,0x0f,0xff,0x3f,0xf0,0x00,0x00,0x00,0x00,0x7f,0xc0,0x00
,0x00,0x00,0x1f,0xf0,0x00,0x0f,0xfe,0x3f,0xf0,0x00,0x00,0x00,0x00,0xff,0xc0,0x00
,0x00,0x00,0x1f,0xf0,0x00,0x1f,0xfe,0x3f,0xf0,0x00,0x00,0x07,0xff,0xff,0xc0,0x00
,0x00,0x00,0x1f,0xf0,0x00,0x1f,0xfc,0x3f,0xf0,0x00,0x00,0x7f,0xff,0xff,0xc0,0x00
,0x00,0x00,0x1f,0xf0,0x00,0x1f,0xfc,0x3f,0xf0,0x00,0x00,0x7f,0xff,0xff,0xc0,0x00
,0x00,0x00,0x1f,0xe0,0x00,0x3f,0xfc,0x3f,0xf0,0x00,0x00,0x7f,0xff,0xff,0xc0,0x00
,0x00,0x00,0x1f,0xe0,0x00,0x3f,0xfc,0x1f,0xf0,0x00,0x00,0x7f,0xff,0xff,0x80,0x00
,0x00,0x00,0x1f,0xe0,0x00,0x7f,0xf0,0x1f,0xf0,0x00,0x00,0x7f,0xff,0xff,0x80,0x00
,0x00,0x00,0x1f,0xe0,0x00,0x7f,0xf0,0x0f,0xf0,0x00,0x00,0x7f,0xff,0xff,0x80,0x00
,0x00,0x00,0x1f,0xe0,0x00,0x7f,0xf0,0x0f,0xf0,0x00,0x00,0x7f,0xff,0xff,0x00,0x00
,0x00,0x00,0x3f,0xe0,0x00,0x7f,0xe0,0x0f,0xf0,0x00,0x00,0x7f,0xf8,0xff,0x00,0x00
,0x00,0x00,0x3f,0xe0,0x00,0x7f,0xe0,0x0f,0xf0,0x00,0x00,0x7f,0x80,0xff,0x00,0x00
,0x00,0x00,0x3f,0xe0,0x00,0x7f,0xe0,0x0f,0xf0,0x00,0x00,0x00,0x00,0xff,0x00,0x00
,0x00,0x00,0x3f,0xe0,0x00,0x7f,0xc0,0x0f,0xf0,0x00,0x00,0x00,0x00,0xff,0x00,0x00
,0x00,0x00,0x3f,0xe0,0x00,0xff,0xc0,0x0f,0xf0,0x00,0x00,0x00,0x00,0xff,0x00,0x00
,0x00,0x00,0x3f,0xe0,0x00,0xff,0x80,0x0f,0xf0,0x00,0x00,0x00,0x00,0xff,0x00,0x00
,0x00,0x00,0x3f,0xe0,0x00,0xff,0x80,0x0f,0xf0,0x00,0x00,0xff,0x80,0xff,0x00,0x00
,0x03,0xfc,0x3f,0xff,0xc0,0xff,0x80,0x0f,0xf0,0x00,0x7f,0xff,0xff,0xff,0x00,0x00
,0x03,0xfe,0x3f,0xff,0xc0,0xff,0x80,0x0f,0xf0,0x0f,0xff,0xff,0xff,0xff,0x00,0x00
,0x03,0xff,0xff,0xff,0xc0,0xff,0x80,0x0f,0xf0,0x0f,0xff,0xff,0xff,0xff,0x00,0x00
,0x03,0xff,0xff,0xff,0xc0,0xff,0x80,0x0f,0xf0,0x0f,0xff,0xff,0xff,0xff,0x00,0x00
,0x03,0xff,0xff,0xff,0xc0,0xff,0x80,0x0f,0xf0,0x0f,0xff,0xff,0xff,0xff,0x00,0x00
,0x03,0xff,0xff,0xff,0xc0,0xff,0x00,0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0x00,0x00
,0x03,0xff,0xff,0xff,0xc0,0x00,0x00,0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0x00,0x00
,0x03,0xff,0xff,0xff,0xc0,0x00,0x00,0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0x00,0x00
,0x03,0xff,0xff,0xfe,0x00,0x00,0x00,0x00,0x00,0x0f,0xff,0xbf,0xff,0xff,0x00,0x00
,0x01,0xff,0xff,0xe0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0xfc,0x00,0x00
,0x00,0x7f,0xfc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00

};


/*
unsigned char bitMap[8192] = {0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00

,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00

,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00

,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00

,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00

,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00

,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00

,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00

};
*/


int main() {
    // Initialize system
    IO::init();

    // Setup UART
    IO::UART& uart = IO::getUART<IO::Pin::UART_TX, IO::Pin::UART_RX>(9600);

    // creates GPIO pins for LCD
    IO::GPIO& regSelect = IO::getGPIO<IO::Pin::PA_3>(EVT::core::IO::GPIO::Direction::OUTPUT); //HUDL: PA_3
    IO::GPIO& reset = IO::getGPIO<IO::Pin::PB_3>(EVT::core::IO::GPIO::Direction::OUTPUT); //HUDL: PB_3
    devices[0] = &IO::getGPIO<IO::Pin::PB_12>(EVT::core::IO::GPIO::Direction::OUTPUT); //HUDL: PB_12
    devices[0]->writePin(IO::GPIO::State::HIGH);

    // Setup SPI 
    IO::SPI& spi = IO::getSPI<IO::Pin::SPI_SCK, IO::Pin::SPI_MOSI>(devices, deviceCount);
    //IO::SPI& spi = IO::getSPI<IO::Pin::SPI_SCK, EVT::core::IO::Pin::SPI_MOSI, EVT::core::IO::Pin::SPI_MISO>(devices, deviceCount);
    spi.configureSPI(SPI_SPEED, SPI_MODE0, SPI_MSB_FIRST);

    // Sets up LCD
    uart.printf("Creating LCD Object...\n\r");
    EVT::core::DEV::LCD lcd(regSelect, reset, spi, bitMap);
    uart.printf("Initializing LCD...\n\r");
    lcd.initLCD();
    while (true) {
        uart.printf("Clearing LCD...\n\r");
        lcd.clearLCD(bitMap);

        uart.printf("Writing to Screen...\n\r");

        lcd.displayMap(bitMap);
        /**
        for(int i = 0; i < 8; i++) {
            for(int j = 0; j < 8; j++) {
                for(int k = 0; k < 16; k++) {
                    lcd.drivePixel(i, j, k, 255);
                    time::wait(8);
                }
                time::wait(8);
            }
            time::wait(8);
        }
        */
        time::wait(500);
    }

    return 0;
}
